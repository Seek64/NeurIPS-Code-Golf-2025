p=lambda g,P=0:[[x-x%~(8in r)%~(P:=-~P*(8in[P*8]+c))*2for*c,x in zip(*g,r)]for r in g]