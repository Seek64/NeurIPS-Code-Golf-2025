p=lambda g,k=1199,q=[0]*9:-k*g or p([q:=(a:=0)or[a:=c%~c&[max(a,c,d,k:=k-1),1+(min(map(F:=(w:=sum(g,[])).count,w))==F(c))][k<99]for d,c in zip([0]+q,r)]for r in zip(*g[::-1])],k)