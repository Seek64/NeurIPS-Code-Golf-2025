p=lambda g,n=3:-n*g or p([[r[i]or(2+n%2*6in r[:i]!=8-n%2*6in sum(g[i:],[]))*4for i,c in enumerate(g)]for*r,in zip(*g)][::-1],n-1)