*Z,h=(0,)*3,lambda g,d=0:[[x and sum({*q+r+s}-{5})for x in 3*r][3-d:][:3]for q,r,s in zip(Z+g,g,g[1:]+Z)if any(r)or(5in q and(d:=d+q.index(5)-s.index(5)))*0]
p=lambda g:[*zip(*h([*zip(*g)]))]