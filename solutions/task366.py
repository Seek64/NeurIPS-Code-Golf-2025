def p(s):n,p,f=sorted(set(z:=sum(s,[])),key=z.count)[-3:];r,s=[[r[:len(s[0])//2]for r in s],[r for r in s[:len(s)//2]],[r[len(s[0])//2:]for r in s],[r for r in s[len(s)//2:]]][len(s)>len(s[0])::2][::1-2*(p in s[0][:8])];[exec('for r in s[e:e+t]:r[a:a+d]=[p]*d')or[all(r[o+p][a:a+d]==[(r,f)[r==n]for r in c[p]]for p in range(t))and exec('for p in range(t):r[o+p][a:a+d]=c[p]')for o in range(len(s)-t+1)for a in range(len(s[0])-d+1)]for o in range(3,0,-1)for e in range(len(s))for a in range(len(s[0]))for t in range(len(s)-e,0,-1)for d in range(len(s[0])-a,0,-1)if p not in(z:=sum(c:=[r[a:a+d]for r in s[e:e+t]],[]))and t*d-z.count(n)==o];return r