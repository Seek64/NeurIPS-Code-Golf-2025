p=lambda g,X=0:[[X:=sum(r)%8*~X%84,[(X in g)*8>>x|332%(2+sum(r[:i+1])*sum(r[i:]))for i,x in enumerate(r)],g:=g+[X]*(8in r)][1]for r in g]