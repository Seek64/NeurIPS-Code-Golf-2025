from re import*
def p(l):
 K=[[0]*U];f=sub('1',')0(',sub('[^1]+'*S,lambda l:'.'*len(l[0]),str(l:=K+[[0,*r,0]for r in l]+K))).strip('(.)')
 for e in[1,-1,1]*8:l[::e]=zip(*eval('1'.join(split(f,'%s'%l))))
 return[e[1:-1]for e in l[1:-1]]